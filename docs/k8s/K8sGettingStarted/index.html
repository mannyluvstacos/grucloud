<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.74">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="GruCloud Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="GruCloud Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-179962442-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-179962442-1",{anonymize_ip:!0})</script><title data-react-helmet="true">Kubernetes Getting Started | GruCloud</title><meta data-react-helmet="true" property="og:url" content="https://grucloud.github.io//docs/k8s/K8sGettingStarted"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Kubernetes Getting Started | GruCloud"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><link data-react-helmet="true" rel="shortcut icon" href="/img/cloud.svg"><link data-react-helmet="true" rel="canonical" href="https://grucloud.github.io//docs/k8s/K8sGettingStarted"><link data-react-helmet="true" rel="alternate" href="https://grucloud.github.io//docs/k8s/K8sGettingStarted" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://grucloud.github.io//docs/k8s/K8sGettingStarted" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9f3870a2.css">
<link rel="preload" href="/assets/js/styles.61910dda.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.ac591651.js" as="script">
<link rel="preload" href="/assets/js/main.765da210.js" as="script">
<link rel="preload" href="/assets/js/1.0aa3b47a.js" as="script">
<link rel="preload" href="/assets/js/2.6eb3c71b.js" as="script">
<link rel="preload" href="/assets/js/3.43262c38.js" as="script">
<link rel="preload" href="/assets/js/1be78505.e9842200.js" as="script">
<link rel="preload" href="/assets/js/172.87450a10.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.effc0978.js" as="script">
<link rel="preload" href="/assets/js/17896441.19fa0f51.js" as="script">
<link rel="preload" href="/assets/js/b9b6d490.e85eadbd.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/cloud.svg" alt="GruCloud Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/cloud.svg" alt="GruCloud Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">GruCloud</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/grucloud/grucloud" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/cloud.svg" alt="GruCloud Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/cloud.svg" alt="GruCloud Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">GruCloud</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/Introduction">Docs</a></li><li class="menu__list-item"><a href="https://github.com/grucloud/grucloud" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/Introduction">What is GruCloud ?</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aws/AwsGettingStarted">Aws Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/google/GoogleGettingStarted">GCP Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/azure/AzureGettingStarted">Azure Getting Started</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/k8s/K8sGettingStarted">Kubernetes Getting Started</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Providers</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">AWS</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/ResourcesList">Resources List</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ACM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ACM/Certificate">Certificate</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">APIGateway</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/APIGateway/Account">Account</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/APIGateway/Authorizer">Authorizer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/APIGateway/DomainName">Domain Name</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/APIGateway/RestApi">RestApi</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/APIGateway/Stage">Stage</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ApiGatewayV2</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ApiGatewayV2/Api">Api</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ApiGatewayV2/ApiMapping">ApiMapping</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ApiGatewayV2/Authorizer">Authorizer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ApiGatewayV2/Deployment">Deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ApiGatewayV2/DomainName">DomainName</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ApiGatewayV2/Integration">Integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ApiGatewayV2/Route">Route</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ApiGatewayV2/Stage">Stage</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">AppSync</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/AppSync/DataSource">DataSource</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/AppSync/GraphqlApi">GraphqlApi</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/AppSync/Resolver">Resolver</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">AutoScaling</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/AutoScaling/AutoScalingAttachment">AutoScaling Attachment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/AutoScaling/AutoScalingGroup">AutoScaling Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/AutoScaling/LaunchConfiguration">Launch Configuration</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">CloudFront</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/CloudFront/Distribution">Distribution</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">CloudWatchEvents</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/CloudWatchEvents/EventBus">EventBus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/CloudWatchEvents/Rule">Rule</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">CloudWatchLogs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/CloudWatchLogs/LogGroup">LogGroup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">DynamoDB</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/DynamoDB/Table">Table</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">EC2</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/EC2">Instance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/ElasticIpAddress">Elastic Ip Address</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/Image">AMI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/InternetGateway">Internet Gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/KeyPair">KeyPair</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/LaunchTemplate">Launch Template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/NatGateway">Nat Gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/NetworkAcl">Network Access Control List</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/Route">Route</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/RouteTable">Route Table</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/RouteTableAssociation">Route Table Association</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/SecurityGroup">Security Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/SecurityGroupRuleEgress">SecurityGroupRuleEgress</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/SecurityGroupRuleIngress">SecurityGroupRuleIngress</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/Subnet">Subnet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/Volume">EBS Volume</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EC2/Vpc">Vpc</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ECR</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ECR/Registry">Registry</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ECR/Repository">Repository</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ECS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ECS/CapacityProvider">CapacityProvider</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ECS/Cluster">Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ECS/Service">Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ECS/TaskDefinition">TaskDefinition</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">EKS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EKS/Cluster">Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/EKS/NodeGroup">Node Group</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ELBv2</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ELBv2/Listener">Listener</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ELBv2/LoadBalancer">Load Balancer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ELBv2/Rule">Rule</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/ELBv2/TargetGroup">Target Group</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">IAM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/IAM/Group">Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/IAM/InstanceProfile">Instance Profile</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/IAM/OpenIDConnectProvider">OpenIDConnectProvider</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/IAM/Policy">Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/IAM/Role">Role</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/IAM/User">User</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">KMS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/KMS/Key">Key</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Lambda</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/Lambda/EventSourceMapping">Event Source Mapping</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/Lambda/Function">Function</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/Lambda/Layer">Layer</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">RDS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/RDS/DBCluster">DB Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/RDS/DBInstance">DB Instance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/RDS/DBSubnetGroup">DB Subnet Group</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Route53</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/Route53/HostedZone">Hosted Zone</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/Route53/Record">Record</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Route53Domains</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/Route53Domains/Domain">Domains</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">S3</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/S3/Bucket">Bucket</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/S3/Object">Object</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">SQS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/SQS/Queue">Queue</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">SSM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/resources/SSM/Parameter">Parameter</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/aws/AwsRequirements">Requirements</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">GCP</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/ResourcesList">Resources List</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">compute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/Address">Address</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/BackendBucket">Backend Bucket</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/Disk">Disk</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/Firewall">Firewall</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/GlobalForwardingRule">Global Forwarding Rule</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/HttpsTargetProxy">Https Target Proxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/Network">Network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/Project">Project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/SslCertificate">SSL Certificate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/SubNetwork">SubNetwork</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/UrlMap">Url Map</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/compute/VmInstance">VM Instance</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">dns</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/dns/DnsManagedZone">Dns Managed Zone</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">iam</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/iam/Binding">Binding</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/iam/Member">Member</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/iam/Policy">Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/iam/ServiceAccount">Service Account</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">storage</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/storage/Bucket">Bucket</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/resources/storage/Object">Object</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/google/GoogleRequirements">Google Requirements</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Azure</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/azure/ResourcesList">Resources List</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">compute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/azure/resources/compute/VirtualMachine">Virtual Machine</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">resourceManagement</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/azure/resources/resourceManagement/ResourceGroup">Resource Group</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">virtualNetworks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/azure/resources/virtualNetworks/NetworkInterface">Network Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/azure/resources/virtualNetworks/PublicIpAddress">Public Ip Address</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/azure/resources/virtualNetworks/SecurityGroup">Security Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/azure/resources/virtualNetworks/Subnet">Subnet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/azure/resources/virtualNetworks/VirtualNetwork">Virtual Network</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/azure/AzureRequirements">Requirements</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Kubernetes</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">K8s Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/ClusterRole">Cluster Role</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/ClusterRoleBinding">Cluster Role Binding</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/ConfigMap">ConfigMap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/Deployment">Deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/Ingress">Ingress</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/Namespace">Namespace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/PersistentVolume">PersistentVolume</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/PersistentVolumeClaim">Persistent Volume Claim</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/Role">Role</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/RoleBinding">Role Binding</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/Secret">Secret</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/Service">Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/ServiceAccount">Service Account</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/resources/StatefulSet">StatefulSet</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/k8s/K8sRequirements">Requirements</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/gc">gc</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/New">New Project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/Init">Init</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/PlanQuery">Plan Query</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/PlanApply">Plan Apply</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/List">List Resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/Tree">Tree</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/PlanDestroy">Plan Destroy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/Hook">Run Hooks</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Kubernetes Getting Started</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>The Kubernetes Grucloud provider allows to define and describe Kubernetes manifests in Javascript, removing the need to write YAML or template files.</p><p>The GruCloud Command Line Interface <strong>gc</strong> reads a description in Javascript and connects to the k8s control plane to apply the new or updated resource definitions.</p><p>For this tutorial, we will define a <a href="https://www.grucloud.com/docs/k8s/resources/Namespace" target="_blank" rel="noopener noreferrer">Namespace</a>, a <a href="https://www.grucloud.com/docs/k8s/resources/Service" target="_blank" rel="noopener noreferrer">Service</a>, and a <a href="https://www.grucloud.com/docs/k8s/resources/Deployment" target="_blank" rel="noopener noreferrer">Deployment</a> to deploy an Nginx web server.</p><p><img src="https://raw.githubusercontent.com/grucloud/grucloud/main/examples/k8s/tuto1/artifacts/diagram-target.svg" alt="diagram-target"></p><blockquote><p>This diagram is generated from the code with <code>gc graph</code></p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h2><p>Ensure <strong>kubectl</strong> is installed, and <strong>minikube</strong> is started: <a href="/docs/k8s/K8sRequirements">K8s Requirements</a></p><p>It is always a good idea to verify the current <em>kubectl</em> context, especially when switching k8s clusters:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl config current-context</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="getting-grucloud-cli-gc"></a>Getting GruCloud CLI: gc<a class="hash-link" href="#getting-grucloud-cli-gc" title="Direct link to heading">#</a></h3><p>The GruCloud CLI, <code>gc</code>, is written in Javascript and run on <a href="https://nodejs.org/" target="_blank" rel="noopener noreferrer">Node.js</a>, hence <em>node</em> is required:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">node --version</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Install <code>gc</code> in just one command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> i -g @grucloud/core</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Verify <em>gc</em> is installed properly by displaying the version:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gc --version</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="project-content"></a>Project Content<a class="hash-link" href="#project-content" title="Direct link to heading">#</a></h2><p>We&#x27;ll describe in the next sections the 4 files required for this <em>infrastructure as code</em> project:</p><ul><li><a href="https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/package.json" target="_blank" rel="noopener noreferrer">package.json</a></li><li><a href="https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/config.js" target="_blank" rel="noopener noreferrer">config.js</a></li><li><a href="https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/iac.js" target="_blank" rel="noopener noreferrer">iac.js</a></li><li><a href="https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/hook.js" target="_blank" rel="noopener noreferrer">hook.js</a></li></ul><blockquote><p>The link to the <a href="https://github.com/grucloud/grucloud/tree/main/examples/k8s/tuto1" target="_blank" rel="noopener noreferrer">source code for this tutorial</a></p></blockquote><p>Let&#x27;s create a new project directory</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir tuto</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd tuto</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="packagejson"></a>package.json<a class="hash-link" href="#packagejson" title="Direct link to heading">#</a></h3><p>The <code>npm init</code> command will create a basic <em>package.json</em>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">npm init</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Let&#x27;s install the <a href="https://www.npmjs.com/package/@grucloud/provider-k8s" target="_blank" rel="noopener noreferrer">GruCloud Kubernetes provider</a> and the SDK. We&#x27;ll also install <a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">axios</a> and <a href="https://rubico.land/" target="_blank" rel="noopener noreferrer">rubico</a>, needed for the post-deployment hooks, which does some final health check.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">npm install @grucloud/core @grucloud/provider-k8s rubico axios</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configjs"></a>config.js<a class="hash-link" href="#configjs" title="Direct link to heading">#</a></h3><p>Create the <strong>config.js</strong> which contains the configuration for this project:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// config.js</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> pkg </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./package.json&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  projectName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> pkg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  namespace</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;myapp&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  appLabel</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nginx-label&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  service</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nginx-service&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  deployment</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nginx-deployment&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    container</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nginx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> image</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nginx:1.14.2&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="iacjs"></a>iac.js<a class="hash-link" href="#iacjs" title="Direct link to heading">#</a></h3><p>Let&#x27;s create the <em>iac.js</em> with the following content:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// iac.js</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">K8sProvider</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@grucloud/provider-k8s&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Create a namespace, service and deployment</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">createResource</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> provider </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> config </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> namespace </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">makeNamespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> service </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">makeService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dependencies</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> namespace </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">properties</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      spec</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        selector</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          app</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">appLabel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        type</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;NodePort&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ports</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;TCP&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            port</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            targetPort</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            nodePort</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">30020</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> deployment </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">makeDeployment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">deployment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dependencies</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> namespace </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">properties</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      metadata</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        labels</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          app</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">appLabel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      spec</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        replicas</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        selector</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          matchLabels</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            app</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">appLabel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        template</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          metadata</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            labels</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              app</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">appLabel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          spec</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            containers</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">deployment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                image</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">deployment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                ports</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    containerPort</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> deployment </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">exports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">createStack</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> createProvider </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> provider </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">K8sProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> config</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./config&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> resources </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createResource</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> provider </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> hooks</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./hook&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hookjs"></a>hook.js<a class="hash-link" href="#hookjs" title="Direct link to heading">#</a></h3><p>When the resources are created, any code can be invoked, defined in <a href="https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/hook.js" target="_blank" rel="noopener noreferrer">hook.js</a>, useful to perform some final health check.</p><p>In this case, the <em>kubectl port-forward</em> is called with the right option:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl --namespace myapp port-forward svc/nginx-service 8081:80</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then, we&#x27;ll use the <em>axios</em> library to perform HTTP calls to the web server, retrying if necessary.</p><p>When the website is up, it will open a browser at <a href="http://localhost:8081" target="_blank" rel="noopener noreferrer">http://localhost:8081</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// hook.js</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> assert </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;assert&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token maybe-class-name">Axios</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;axios&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> pipe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> eq</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> or </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rubico&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> first </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rubico/x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> retryCallOnError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@grucloud/core&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">Retry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> shell </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;shelljs&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> resources</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> provider </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> localPort </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8081</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> url </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string string" style="color:rgb(195, 232, 141)">http://localhost:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">localPort</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> servicePort </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">pipe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">properties</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spec.ports&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    first</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;port&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> kubectlPortForwardCommand </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string string" style="color:rgb(195, 232, 141)">kubectl --namespace </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">resources</span><span class="token template-string interpolation punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token template-string interpolation">namespace</span><span class="token template-string interpolation punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string string" style="color:rgb(195, 232, 141)"> port-forward svc/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">resources</span><span class="token template-string interpolation punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token template-string interpolation">service</span><span class="token template-string interpolation punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string string" style="color:rgb(195, 232, 141)"> </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">localPort</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string string" style="color:rgb(195, 232, 141)">:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">servicePort</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> axios </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token maybe-class-name">Axios</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    timeout</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15e3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    withCredentials</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    onDeployed</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">init</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      actions</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string string" style="color:rgb(195, 232, 141)">exec: &#x27;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">kubectlPortForwardCommand</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string string" style="color:rgb(195, 232, 141)">&#x27;, check web server at </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">url</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">command</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// start kubectl port-forward</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> child </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> shell</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">exec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">kubectlPortForwardCommand</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> async</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            child</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">stdout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Get the web page, retry until it succeeds</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">retryCallOnError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string string" style="color:rgb(195, 232, 141)">get </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">url</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">fn</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> axios</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">shouldRetryOnException</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token parameter"> error </span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">or</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token function" style="color:rgb(130, 170, 255)">eq</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;code&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ECONNREFUSED&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token function" style="color:rgb(130, 170, 255)">eq</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;response.status&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">404</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">isExpectedResult</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">assert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;content-type&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string string" style="color:rgb(195, 232, 141)">text/html</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">includes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">status</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              config</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> retryCount</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> retryDelay</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5e3</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Open a browser</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            shell</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">exec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string string" style="color:rgb(195, 232, 141)">open </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">url</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> async</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    onDestroyed</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">init</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="workflow"></a>Workflow<a class="hash-link" href="#workflow" title="Direct link to heading">#</a></h2><p>We&#x27;ll describe the most useful <em>gc</em> commands: <code>apply</code>, <code>list</code>, <code>destroy</code>, and <code>plan</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deploy"></a>Deploy<a class="hash-link" href="#deploy" title="Direct link to heading">#</a></h3><p>We are now ready to deploy the resources with the <a href="https://www.grucloud.com/docs/cli/PlanApply" target="_blank" rel="noopener noreferrer">apply</a> command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gc apply</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The first part is to find out the plan, i.e what is going to be deployed.
You will be prompted if you accept or abort.
When typing: &#x27;y&#x27;, the resources will be deployed: a namespace, a service, and a deployment.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Querying resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✓ k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 7/7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Querying</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Namespace 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Service 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Deployment 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ 1 Namespace from k8s                                                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────┬──────────┬────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Name     │ Action   │ Data                                                                           │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────┼──────────┼────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ myapp    │ CREATE   │ apiVersion: v1                                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │ kind: Namespace                                                                │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │ metadata:                                                                      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │   name: myapp                                                                  │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │   annotations:                                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │     Name: myapp                                                                │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │     ManagedBy: GruCloud                                                        │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │     CreatedByProvider: k8s                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │     stage: dev                                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │     projectName: @grucloud/example-k8s-tuto1                                   │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│          │          │                                                                                │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└──────────┴──────────┴────────────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ 1 Service from k8s                                                                                   │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────────────────┬──────────┬────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Name                 │ Action   │ Data                                                               │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────────────────┼──────────┼────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ myapp::nginx-service │ CREATE   │ spec:                                                              │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │   selector:                                                        │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │     app: nginx-label                                               │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │   type: NodePort                                                   │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │   ports:                                                           │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │     - protocol: TCP                                                │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │       port: 80                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │       targetPort: 8080                                             │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │ apiVersion: v1                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │ kind: Service                                                      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │ metadata:                                                          │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │   name: nginx-service                                              │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │   annotations:                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │     Name: nginx-service                                            │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │     ManagedBy: GruCloud                                            │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │     CreatedByProvider: k8s                                         │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │     stage: dev                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │     projectName: @grucloud/example-k8s-tuto1                       │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │   namespace: myapp                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                      │          │                                                                    │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└──────────────────────┴──────────┴────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ 1 Deployment from k8s                                                                                │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─────────────────────────┬──────────┬─────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Name                    │ Action   │ Data                                                            │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─────────────────────────┼──────────┼─────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ myapp::nginx-deployment │ CREATE   │ metadata:                                                       │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │   labels:                                                       │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     app: nginx-label                                            │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │   name: nginx-deployment                                        │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │   annotations:                                                  │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     Name: nginx-deployment                                      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     ManagedBy: GruCloud                                         │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     CreatedByProvider: k8s                                      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     stage: dev                                                  │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     projectName: @grucloud/example-k8s-tuto1                    │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │   namespace: myapp                                              │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │ spec:                                                           │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │   replicas: 1                                                   │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │   selector:                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     matchLabels:                                                │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │       app: nginx-label                                          │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │   template:                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     metadata:                                                   │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │       labels:                                                   │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │         app: nginx-label                                        │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     spec:                                                       │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │       containers:                                               │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │         - name: nginx                                           │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │           image: nginx:1.14.2                                   │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │           ports:                                                │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │             - containerPort: 80                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │ apiVersion: apps/v1                                             │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │ kind: Deployment                                                │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │                                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└─────────────────────────┴──────────┴─────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Plan summary for provider k8s                                                                       │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ DEPLOY RESOURCES                                                                                    │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Namespace          │ myapp                                                                          │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Service            │ myapp::nginx-service                                                           │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Deployment         │ myapp::nginx-deployment                                                        │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴────────────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Are you sure to deploy 3 resources, 3 types on 1 provider? … yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Deploying resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✓ k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Deploying</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Namespace 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Service 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Deployment 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3 resources deployed of 3 types and 1 provider</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Running OnDeployedGlobal resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc a&quot; executed in 30s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In the case of the <code>Deployment</code> type manifest, <strong>gc</strong> will query the pod that is started by the deployment through the replica set, when one of the container&#x27;s pod is ready, the deployment can proceed.</p><p>Later on, when we deal with the <code>Ingress</code> type, <strong>gc</strong> will wait for the load balancer to be ready.</p><p>The command <code>gc apply</code> is the equivalent of <code>kubectl apply -f mymanifest.yaml</code> but it waits for resources to be up and running, ready to serve.</p><p>We could try to run the <code>gc apply</code> or the <code>gc plan</code>, we should not expect any deployment or destruction of resources.</p><p>In the mathematical and computer science world, we could say that <em>apply</em> (and <em>destroy</em>) commands are <a href="https://en.wikipedia.org/wiki/Idempotence" target="_blank" rel="noopener noreferrer">idempotent</a>: &quot;property of certain operations in mathematics and computer science whereby they can be applied multiple times without changing the result beyond the initial application&quot;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="list"></a>List<a class="hash-link" href="#list" title="Direct link to heading">#</a></h3><p>Let&#x27;s verify that the resources are deployed with the <em>gc list</em> command:</p><p>A live diagram will be also generated.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gc list --our --all --graph</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">List Summary:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ k8s                                                                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Namespace          │ myapp                                                                          │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Service            │ myapp::nginx-service                                                           │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Deployment         │ myapp::nginx-deployment                                                        │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ ReplicaSet         │ myapp::nginx-deployment-66cdc8d56b                                             │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Pod                │ myapp::nginx-deployment-66cdc8d56b-4d8lz                                       │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴────────────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">5 resources, 15 types, 1 provider</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc list --our --all --graph&quot; executed in 0s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><img src="https://raw.githubusercontent.com/grucloud/grucloud/main/examples/k8s/tuto1/artifacts/diagram-live.svg" alt="diagram-live"></p><p>Notice the relationship between the Pod, ReplicaSet and Deployment.</p><p>The Deployment creates a ReplicaSet which creates a one or more Pod(s).</p><p>When querying the <em>k8s-api-server</em> for the live resources, the pod contains information about its ReplicaSet parent, who has itself information about its parent Deployment. This allows <em>gc</em> to find out the links between the resources.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="post-deploy-hook"></a>Post Deploy Hook<a class="hash-link" href="#post-deploy-hook" title="Direct link to heading">#</a></h3><p>Would like to check the health of the system? You can run the <em>onDeployed</em> hook any time with the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gc run --onDeployed</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Running OnDeployed resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Forwarding from 127.0.0.1:8081 -&gt; 80</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Forwarding from [::1]:8081 -&gt; 80</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Handling connection for 8081</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✓ k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ default::onDeployed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ exec: &#x27;kubectl --namespace myapp port-forward svc/nginx-service 8081:80&#x27;, check web server at http://localhost:8081</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc run --onDeployed&quot; executed in 5s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="update"></a>Update<a class="hash-link" href="#update" title="Direct link to heading">#</a></h3><p>Now that the initial deployment is successful, some changes will be made, for instance, let&#x27;s change the Nginx container version, located at <a href="https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/config.js" target="_blank" rel="noopener noreferrer">config.js</a>.</p><blockquote><p>Browse the list of Nginx images at <a href="https://hub.docker.com/_/nginx" target="_blank" rel="noopener noreferrer">https://hub.docker.com/_/nginx</a></p></blockquote><p>Let&#x27;s try the version <code>nginx:1.20.0-alpine</code>.</p><p>For a preview of the change that will be made, use the <em>plan</em> command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gc plan</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Querying resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✓ k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 7/7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Querying</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Namespace 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Service 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Deployment 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ 1 Deployment from k8s                                                                                             │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─────────────────────────┬──────────┬──────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Name                    │ Action   │ Data                                                                         │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─────────────────────────┼──────────┼──────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ myapp::nginx-deployment │ UPDATE   │ added:                                                                       │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │ deleted:                                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │ updated:                                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │   spec:                                                                      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │     template:                                                                │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │       spec:                                                                  │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │         containers:                                                          │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │           0:                                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │             image: nginx:1.20.0-alpine                                       │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │          │                                                                              │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└─────────────────────────┴──────────┴──────────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Plan summary for provider k8s                                                                                    │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ DEPLOY RESOURCES                                                                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Deployment         │ myapp::nginx-deployment                                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">? Are you sure to deploy 1 resource, 1 type on 1 provider? › (y/N)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice this time the action is not <code>CREATE</code> but <code>UPDATE</code>. <strong>gc</strong> fetched the live resources from the <em>kubernetes-api-server</em>, compared them with the target resources defined in the code, and has found out the deployment needs to be updated.</p><p>Now we can apply the change:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gc apply</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The updated Nginx image should be up and running.</p><p>Let&#x27;s double-check the state of the Nginx deployment, filtering by <em>type</em> and <em>name</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gc list -t Deployment --name nginx-deployment</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Listing resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✓ k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 6/6</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ 1 Deployment from k8s                                                                                             │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─────────────────────────┬──────────────────────────────────────────────────────────────────────────────────┬──────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Name                    │ Data                                                                             │ Our  │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─────────────────────────┼──────────────────────────────────────────────────────────────────────────────────┼──────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ myapp::nginx-deployment │ metadata:                                                                        │ Yes  │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   name: nginx-deployment                                                         │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   namespace: myapp                                                               │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   uid: 7c9bf366-cbf4-47d9-a7b7-e3da900b75dc                                      │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   resourceVersion: 7111                                                          │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   generation: 2                                                                  │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   creationTimestamp: 2021-04-28T19:51:37Z                                        │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   labels:                                                                        │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     app: nginx-label                                                             │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   annotations:                                                                   │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     CreatedByProvider: k8s                                                       │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     ManagedBy: GruCloud                                                          │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     Name: nginx-deployment                                                       │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     deployment.kubernetes.io/revision: 2                                         │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     projectName: @grucloud/example-k8s-tuto1                                     │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     stage: dev                                                                   │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │ spec:                                                                            │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   replicas: 1                                                                    │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   selector:                                                                      │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     matchLabels:                                                                 │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       app: nginx-label                                                           │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   template:                                                                      │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     metadata:                                                                    │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       creationTimestamp: null                                                    │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       labels:                                                                    │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │         app: nginx-label                                                         │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     spec:                                                                        │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       containers:                                                                │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │         - name: nginx                                                            │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │           image: nginx:1.20.0-alpine                                             │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │           ports:                                                                 │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │             - containerPort: 80                                                  │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │               protocol: TCP                                                      │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │           resources:                                                             │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │           terminationMessagePath: /dev/termination-log                           │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │           terminationMessagePolicy: File                                         │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │           imagePullPolicy: IfNotPresent                                          │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       restartPolicy: Always                                                      │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       terminationGracePeriodSeconds: 30                                          │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       dnsPolicy: ClusterFirst                                                    │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       securityContext:                                                           │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       schedulerName: default-scheduler                                           │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   strategy:                                                                      │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     type: RollingUpdate                                                          │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     rollingUpdate:                                                               │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       maxUnavailable: 25%                                                        │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       maxSurge: 25%                                                              │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   revisionHistoryLimit: 10                                                       │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   progressDeadlineSeconds: 600                                                   │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │ status:                                                                          │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   observedGeneration: 2                                                          │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   replicas: 1                                                                    │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   updatedReplicas: 1                                                             │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   readyReplicas: 1                                                               │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   availableReplicas: 1                                                           │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │   conditions:                                                                    │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     - type: Available                                                            │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       status: True                                                               │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       lastUpdateTime: 2021-04-28T19:51:39Z                                       │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       lastTransitionTime: 2021-04-28T19:51:39Z                                   │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       reason: MinimumReplicasAvailable                                           │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       message: Deployment has minimum availability.                              │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │     - type: Progressing                                                          │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       status: True                                                               │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       lastUpdateTime: 2021-04-28T20:03:08Z                                       │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       lastTransitionTime: 2021-04-28T19:51:37Z                                   │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       reason: NewReplicaSetAvailable                                             │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │       message: ReplicaSet &quot;nginx-deployment-675bd9f4f7&quot; has successfully progre… │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│                         │                                                                                  │      │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└─────────────────────────┴──────────────────────────────────────────────────────────────────────────────────┴──────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">List Summary:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ k8s                                                                                                              │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Deployment         │ myapp::nginx-deployment                                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1 resource, 5 types, 1 provider</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc list -t Deployment --name nginx-deployment&quot; executed in 0s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Great, as expected, the new version has been updated.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="destroy"></a>Destroy<a class="hash-link" href="#destroy" title="Direct link to heading">#</a></h3><p>To destroy the resources allocated in the right order:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gc destroy</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Destroy summary for provider k8s                                                                                 │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Namespace          │ myapp                                                                                       │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Service            │ myapp::nginx-service                                                                        │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────┤</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│ Deployment         │ myapp::nginx-deployment                                                                     │</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✔ Are you sure to destroy 3 resources, 3 types on 1 provider? … yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Destroying resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✓ k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Destroying</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Namespace 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Service 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ✓ Deployment 1/1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ default::onDestroyed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3 resources destroyed, 3 types on 1 provider</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Running OnDestroyedGlobal resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc d&quot; executed in 1m 17s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>At this stage, all the Kubernetes resources should have been destroyed.
We could try to run <em>gc destroy</em> command again, nothing should be destroyed or deployed:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gc d</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><div tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Find Deletable resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">✓ k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Initialising</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ✓ Listing 7/7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">No resources to destroy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Running OnDestroyedGlobal resources on 1 provider: k8s</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Command &quot;gc d&quot; executed in 0s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>As expected, the <em>destroy</em> command is idempotent.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="debugging"></a>Debugging<a class="hash-link" href="#debugging" title="Direct link to heading">#</a></h2><p>A benefit of using a general-purpose programming such as Javascript, is debugging. Thanks <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">Visual Studio Code</a> for providing such an easy way to debug Javascript applications.</p><p>This example contains a vs code file called <a href="https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/.vscode/launch.json" target="_blank" rel="noopener noreferrer">launch.json</a>, which defines various debug targets for <code>gc apply</code>, <code>gc destroy</code> and so on.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>This tutorial described how to deploy, list, and destroy Kubernetes manifests from Javascript code.
In this case, a namespace, a service, and a deployment.</p><p>What&#x27;s next? Let&#x27;s see how to deploy a <a href="https://github.com/grucloud/grucloud/tree/main/examples/starhackit/minikube" target="_blank" rel="noopener noreferrer">full stack application on minikube</a>.</p><p>Ready to try Kubernetes on EKS, the Amazon Elastic Kubernetes Service? Have a look at the project <a href="https://github.com/grucloud/grucloud/tree/main/examples/starhackit/eks-lean" target="_blank" rel="noopener noreferrer">full stack application on EKS</a>.</p><p>Maybe you prefer using <a href="https://kops.sigs.k8s.io/" target="_blank" rel="noopener noreferrer">kops</a> to set up your cluster? The tutorial <a href="https://dev.to/fredericheem/setup-kops-on-aws-with-grucloud-oia" target="_blank" rel="noopener noreferrer">Setup Kops on AWS with Grucloud</a> explains how to automate the <em>kops</em> setup</p><p>Are you looking to install the <em>cert manager</em>, <em>web ui dashboard</em>, <em>prometheus</em>, and more? Browse the <a href="https://www.grucloud.com/docs/k8s/K8sModules" target="_blank" rel="noopener noreferrer">GruCloud K8s Modules</a> and find out how to install and use these npm packages into your code.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/azure/AzureGettingStarted"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Azure Getting Started</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/aws/ResourcesList"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Resources List »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#requirements" class="table-of-contents__link">Requirements</a><ul><li><a href="#getting-grucloud-cli-gc" class="table-of-contents__link">Getting GruCloud CLI: gc</a></li></ul></li><li><a href="#project-content" class="table-of-contents__link">Project Content</a><ul><li><a href="#packagejson" class="table-of-contents__link">package.json</a></li><li><a href="#configjs" class="table-of-contents__link">config.js</a></li><li><a href="#iacjs" class="table-of-contents__link">iac.js</a></li><li><a href="#hookjs" class="table-of-contents__link">hook.js</a></li></ul></li><li><a href="#workflow" class="table-of-contents__link">Workflow</a><ul><li><a href="#deploy" class="table-of-contents__link">Deploy</a></li><li><a href="#list" class="table-of-contents__link">List</a></li><li><a href="#post-deploy-hook" class="table-of-contents__link">Post Deploy Hook</a></li><li><a href="#update" class="table-of-contents__link">Update</a></li><li><a href="#destroy" class="table-of-contents__link">Destroy</a></li></ul></li><li><a href="#debugging" class="table-of-contents__link">Debugging</a></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div><style data-emotion-css="1dszc5b">.css-1dszc5b{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;}</style><div class="css-1dszc5b"><style data-emotion-css="1qkzzwm">.css-1qkzzwm{margin:20px;}</style><div class="css-1qkzzwm"><h4 class="footer__title">Community</h4><style data-emotion-css="1tzzd34">.css-1tzzd34{padding:0 30px 0 00px;list-style:none;}</style><ul class="css-1tzzd34"><li><a href="https://twitter.com/grucloud_iac" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li><a href="https://stackoverflow.com/questions/tagged/grucloud" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li><a href="https://discord.com/channels/803645280359546920/803645355606147082" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="css-1qkzzwm"><h4 class="footer__title">Documentation</h4><ul class="css-1tzzd34"><li><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/aws/AwsGettingStarted">AWS</a></li><li><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/google/GoogleGettingStarted">Google Cloud</a></li><li><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/azure/AzureGettingStarted">Microsoft Azure</a></li><li><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/k8s/K8sGettingStarted">Kubernetes</a></li></ul></div></div><style data-emotion-css="gk60pb">.css-gk60pb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}.css-gk60pb > div{padding-right:30px;}</style><div class="css-gk60pb"><div>Copyright © 2021 GruCloud</div><a href="https://www.freeprivacypolicy.com/live/ada70892-c887-4a1d-8d0e-29801fe215b2">Privacy Policy</a></div></div></footer></div>
<script src="/assets/js/styles.61910dda.js"></script>
<script src="/assets/js/runtime~main.ac591651.js"></script>
<script src="/assets/js/main.765da210.js"></script>
<script src="/assets/js/1.0aa3b47a.js"></script>
<script src="/assets/js/2.6eb3c71b.js"></script>
<script src="/assets/js/3.43262c38.js"></script>
<script src="/assets/js/1be78505.e9842200.js"></script>
<script src="/assets/js/172.87450a10.js"></script>
<script src="/assets/js/935f2afb.effc0978.js"></script>
<script src="/assets/js/17896441.19fa0f51.js"></script>
<script src="/assets/js/b9b6d490.e85eadbd.js"></script>
</body>
</html>